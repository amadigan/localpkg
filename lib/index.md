# libinstall

This is the source code for libinstall, a zero-dependency zsh script for macOS installs packages from GitHub to ~/.local/bin.

libinstall is specifically designed for the currently supported versions of macOS (13+), but does not require anything else
installed on the system. In particular, the Xcode Command Line Tools are not required.

## Commands used
- `zsh`
- `gh` OR `curl` and `jq`
- `bsdtar`
- `openssl`

## Entrypoints

libinstall has two entrypoints, lp_main, the entrypoint for installer scripts generated by localpkg, and lp_manage, 
the entrypoint for manager scripts generated by the library.

### lp_main options

lp_main is typically invoked by a command in the form

```sh
curl -sL https://github.com/username/repo/releases/latest/download/repo.localpkg | zsh -s
```

As such, it is not expected that the user will pass any options to lp_main. However, the following options are available:

- `--help` (`-h`) - Display help text, including information about the package
- `--update [script]` (`-u [script]`) - Update an existing installation. Installation will stop if the same version is found.

The -u option is used when the manager script executes the installer script from the latest release. The manager script passes
its own location to the installer script, which then executes it to extract information about the current installation,
such as version and files. If `-u` is passed without a script, the installer will attempt to find the manager script in the
`${LOCALPKG_PREFIX}/pkg` directory.

### lp_mgr_main options

The lp_mgr_main script is typically installed to ~/.local/pkg/PKGNAME and is invoked by the user to manage the package. The
following options are available:

- `--help` (`-h`) - Display help text, including information about the package
- `--raw` (`-r`) - Display raw key value pairs for the package, used by the install script when updating

By default, the manage script prints a summary of the package, as follows:

```
PKGNAME (owner/repo) VERSION installed at ~/.local

Commands: PKGNAME

To remove:
~/.local/pkg/PKGNAME remove

To update:
~/.local/pkg/PKGNAME update
```

The installer script (lp_main) uses `-r` to retrieve the package version from the manage script.

Subcommands are also available:

#### remove

The `remove` subcommand removes the package from the system.

`remove` options:

- `--force` (`-f`) - Remove all package files, even if they have been modified since installation
- `--keep` (`-k`) - Retain the package management script if any files are left behind
- `--no-prune` (`-P`) - Do not prune empty directories after removing the package

#### update

The `update` subcommand updates the package to the latest version.

`update` options:

- `--check` (`-c`) - Check for updates but do not install
- `--version` (`-v`) - Update to a specific release tag

#### list

The `list` subcommand lists the files installed by the package.

`list` options:

- `--exec` (`-e`) - List only executable files
- `--bin` (`-b`) - List only executable files in the PATH
- `--sums` (`-s`) - List files and cheksums in the cksum format

Files are sorted for listing. The `--bin` option always searches the PATH prefixed by "${LOCALPKG_PREFIX}/bin". The list -s command
is used by the manage script to find old files to remove.
